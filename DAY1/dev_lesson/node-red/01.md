# 1.GitHub CodespacesでNode-REDを立ち上げる

## 今回の目標
- よく分からなくても何か作れたらOK！

## 今回使用するツール
### Node-RED
Node-REDは、フローベース（処理の流れを「線」でつなぐことで動きを表現する方法）のプログラミングツールです。  
直感的に操作ができ、初心者でも利用しやすいのが特徴です。

**Node-REDのメリット**
- プログラミング不要で素早く開発できる
- WindowsやMacなどの環境の差でのトラブルを気にしなくてよい
- Node.jsなど必要なソフトウェアが最初からインストールされている
- 前に作ったプログラムがちゃんとログに残る
- 講師側が学生の状況を把握しやすく、学生もトラブル発生時に講師側に状況を共有しやすい

ローカル（自分のPC）上で動かす場合には、オープンソースとして無料でインストールすることができます。  
DockerやKubernetesといった仮想環境での提供もなされています。  
パブリッククラウド上での提供もされており、こちらは基本有償ですが自分のPCにインストールする手間がありません。  
ユーザー登録後30日間は、クレジットカード情報の入力も必要なく無償試用ができます。

### LINE Bot
LINEは日本でもっとも利用されているメッセージングアプリです。  
直感的な見た目と操作性により、初心者でも利用しやすいのが特徴です。

LINE Botは、そのLINE上で動作するチャットボット（ロボット）です。  
日頃使っているLINEとはすこし違うものだと思っていてください。

## Node-REDを立ち上げる

GitHub Codespacesを利用します。

**GitHub Codespacesとは**
クラウド上でPC環境を借りられる便利なサービスです。  
GitHubのアカウントがあれば、すぐに使い始めることができ、ソフトウェア開発に必要な環境が最初から整っています。  
無料枠があるため、個人学習や小規模プロジェクトに最適です。


### GitHub アカウントを作成

GitHubアカウントを持っていない場合は、まず以下のURLからGitHubアカウントを作成してください。  

https://github.com/signup  

アカウントに登録するには、メールアドレス、パスワード、ユーザ名などの情報を入力する必要があります。

### リポジトリの準備

下記GitHubリポジトリにNode-RED用のCodespacesテンプレートを用意しました。

補足：ゆるふわ言葉定義  
リポジトリ:作業する大きなフォルダのようなもの  
ディレクトリ:フォルダのこと  
フォーク:他の人のリポジトリをコピーして使えるようにすること  

https://github.com/kazuhitoyokoi/node-red-codespaces

- リポジトリの作成
ホーム画面から右上の方にあるNew repositoryでリポジトリを作成します。

Repository Name: 任意の名前
Public or Private: Publicにチェック
Add a README File: チェック

他はいじらずにCreate repositoryを押してリポジトリを作成します。


- Codespaceの作成
画面中段ほどにあるCodeというボタンから、Create codespace on mainを選択します。

ブラウザで新しくウィンドウもしくはタブが開き、以下のようなロード画面が表示されます。  
人によっては次の画面も含め、少し時間が掛かりますが少し待ちましょう。  
あまりにも時間がかかる場合はページのリロードもしてみてください。

ロードが上手くいくと以下のような表示になります。  
左側のエクスプローラーにREADME.mdのファイルが表示されたり、エディタ画面でREADME.mdのファイルを編集できるようになればGitHub Codespacesの準備OKです。

それでも起動しない場合  
Codespacesの管理画面から一度作成したマシンを削除して再度同じ手順でCodespaceの作成から作り直しをしてみてください。


- 利用の確認
左側のファイル選択部分をエクスプローラー、右上のファイルの編集部分をエディタ、右下のコマンド実行部分をターミナルと言います。  
主にこの3つのエリアを使ってプログラムを書いたり、実行したりしていきます。


- ファイルの編集
GitHub Codespaceseはファイル編集のエディタのVisual Studio CodeとNode.jsなどの実行環境がセットになったパソコンを無料で使い始められる環境です。

まずは、ファイルの編集ができるか試してみましょう。  
左側のエクスプローラーのREADME.mdをクリックすると、右側の編集画面で編集できるようになります。  
試してみましょう。


- コマンドの実行
ターミナルエリアをクリックすると文字を入力できます。  
node -vを入力して実行してみましょう。

$ (ここに`node -v`を入力し、エンター)

実際の環境だとこんな感じです。一般的な表記上は$以降を記載しています。

実行はエンターキーです。  
$はコマンド入力の目印です。 $は入力しません。実際にはnode -vだけを入力します。  
自身で調べていく際にもインターネット上の記事ではこういった記載が基本になるので注意しましょう。  
問題なく実行されるとv18.0.0などといったバージョン情報が表示されます。

実際にはこの資料の手順を実施するタイミングによってバージョン情報は異なります。

このようにターミナルにコマンドを入力して実行することで、特定のプログラムを起動したり、インストールされているソフトウェアを利用できたりします。
以下の記事を元に、pwdやlsといったコマンドを実行してみましょう。


- プログラムの実行 - （Node.jsの実行）

簡単なプログラムを書いて実行してみましょう。  
先ほど個別に試してみた、ファイルの編集とターミナルの操作の両方を使います。  
エクスプローラーで新規ファイル作成（右クリックもしくは新規ファイル作成ボタン）を押して、hello.jsというファイルを作成します。

エディタ画面でconsole.log('こんにちは')とコピペしてみましょう。  
入力でも大丈夫ですが、タイプミスでつまずいてしまう可能性があるのでコピペ推奨です。

右下のターミナルでnode hello.jsと入力（コピペ推奨）し、エンターでプログラムを実行します。  
こんにちはと表示されればOKです。

実際に使っていくときには他の操作も必要になりますが、一旦ここまで出来れば使い始められたと言って大丈夫です。

## GitHub Codespacesに移動する

Node-REDテンプレートリポジトリにアクセスすると、右上隅に「Use this template」という緑色のボタンが表示されます。
このボタンをクリックすると、選択可能な2つのオプションが表示されます。
ここで「Open in a codespace」を選択して、Codespacesでテンプレートリポジトリを開きます。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287766/2683af28-7446-c166-5ec9-74fc075c3239.png" width="450px" alt="image from gyazo"/>


## Node-REDフローエディタを開く

約1分後、この環境は自動的にNode-REDをダウンロードして起動します。  
Node-REDフローエディタを使用する準備が整うと、ダイアログが右下隅にポップアップ表示されます。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287766/a2099064-10de-fde2-793f-fd8963933531.png" width="450px" alt="image from gyazo"/>


　緑色のボタン「ブラウザーで開く」をクリックすると、ブラウザの別のタブが開き、Node-REDフローエディタが表示されます。
この環境では最初にプロジェクト機能のダイアログを開きます。
プロジェクトの構成をスキップするには、右下隅にある「後にする」ボタンをクリックします。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287766/cdd441a1-985a-0404-36eb-335b7e79bcc7.png" width="450px" alt="image from gyazo"/>


　これで、Node-REDフローエディタでフローの開発を始めれるようになりました。

## Tipsと補足情報

※Node-RED環境を作っているけど立ち上がらない場合
基本的に何もしなくてもGitHub Codespacesが立ち上がるとその後に自動的にNode-REDが起動します。
ターミナルに- [info] Started flowsと表示されてれば問題なくNode-REDが立ち上がっています。

ただ、たまに立ち上がらないケースがあるので、その場合は$マークの横にカーソルを合わせて、npm startと入力しエンターキーを押しましょう。

### GitHub Codespacesのタイムアウト時間を延長する

デフォルトでは、Codespacesが用意した環境は30分で終了します。
この時間はNode-REDのフローを開発するには短すぎるため、ユーザの設定URLからタイムアウト時間を延長します。

https://github.com/settings/codespaces#default-idle-timeout-header

　テキスト入力エリアに最大値の240分を入力します。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287766/576e3f85-6cfb-c84b-61d7-4b8692bbe371.png" width="450px" alt="image from gyazo
)


### GitHub Codespacesの再開
- GitHub Codespacesにアクセス
GitHubにログインしている状態で、https://github.com/codespaces にアクセスします。

- 自身が利用していたスペースを見つける

こちらの画像ではGitHub CodespacesでNode-REDを実行する方法の記事を元にNode-REDの環境をGitHub Codespacesで作っていた状態です。  
メニューからOpen in Browserを選択して開きましょう。

- 少し待つとGitHub Codespacesが立ち上がります。  
"Setting up your codespace"と表示がでるので少し待つと環境が立ち上がります。

### GitHub Codespacesの持続時間を延ばす
GitHub Codespacesはデフォルトだと30分ほどでサスペンド（一時停止）してしまいます。  
これを回避するためにGitHub Codespacesの設定を変更して最大4時間（240分）まで延長しておきましょう。  
開発するときには4時間くらいあると安心できます。

こちらから設定できます。

https://github.com/settings/codespaces#default-idle-timeout-header