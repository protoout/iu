# 02. Dify

このパートでは、Difyを使って「盛岡の観光アドバイザー」チャットアプリを最短で作り、さらに無料枠のあるGeminiをモデルとして接続します。  
試作で終わらず、動作確認まで到達するのがゴールです。

## Difyとは？
- 生成AI（LLM）を使って、ノーコードでアプリを作って運用まで持っていくための開発プラットフォームです。  
  ワークフロー、RAG、連携（インテグレーション）、モニタリングなどをまとめて扱えます。
- 読み方は公式で「ディフィー」になっています。

## Difyのメリット
- ノーコード / ローコードで作りやすい  
  画面操作中心でチャットボットや業務用AIアプリを組み立てられ、まず動くものを最短で作れます。
- ワークフローとエージェントで複雑な処理も組める  
  条件分岐やツール呼び出しなどをワークフロー化でき、エージェント的に自律判断させる構成も作れます。
- RAGで自社ナレッジや資料を活用できる  
  ナレッジベースを使った検索 + 生成（RAG）で、社内FAQやドキュメント参照型のAIを構築できます。
- 外部のナレッジ基盤とも連携できる  
  Dify外にあるナレッジベースをAPI経由で接続し、情報ソースを広げることも可能です。
- 目的に合わせてさまざまなLLMを選べる  
  用途に応じてLLMを切り替えながら開発できます。
- 作ったAIをいろいろな場所で使える  
  作成したアプリをデプロイして、外部システムから呼べる形（運用前提）にしやすいです。
- 運用・改善がしやすい（観測・モニタリング）  
  利用状況を見ながら改善を回しやすく、試作から本番運用への移行を意識した設計になっています。

---

## 1. このパートで作るもの「盛岡の観光アドバイザーAIチャット」

### 1-1. 作成するものの概要

- Dify上で動く、盛岡観光の相談に答えるチャットアプリを作ります。
- まずはシンプルなチャットアプリとして完成させ、次のパート（RAG）で資料参照型に拡張していきます。

参考リンク
- [Dify チャットフロー入門（ベース記事）](https://zenn.dev/protoout/articles/81-start-dify-chatflow)
- [Google AI Studio（Gemini APIキー発行）](https://aistudio.google.com/apikey)
- [Groq コンソール（予備のAPIキー発行）](https://console.groq.com/home)

---

## 2. Difyで盛岡の観光アドバイザーAIチャットを作るハンズオン

### 2-1. 準備: Difyアカウントと事前注意

まずはこちらの記事を元に、Difyでチャットアプリを作成します。  
記事内のプロンプトは秋葉原ではなく、盛岡の観光アドバイザーとして作ってみましょう。

- Difyでチャットアプリを作る（ベース記事）
  - [Dify チャットフロー入門](https://zenn.dev/protoout/articles/81-start-dify-chatflow)

---

### 2-2. チャットアプリ作成（プロンプトを盛岡版にする）

ベース記事の手順に沿って、まずはチャットが動くところまで作ります。

- 設定のポイント
  - システムプロンプトを 盛岡の観光アドバイザー に変更する
  - 相談例（会話スターター）があると動作確認が速くなります

プロンプト例（コピペ用）
- 役割: 盛岡の観光アドバイザー
- 条件: 旅行者の目的や日程を確認してから提案する
- 出力: 箇条書きを基本に、最後におすすめの次アクションを1つ添える

---

### 2-3. モデルプロバイダーをGeminiへ接続（APIキー設定）

Difyはモデルプロバイダー画面から、使用するLLMを追加できます。  
無料枠があるGeminiを使うと、最初の試作が進めやすいです。

#### 2-3-1. GeminiのAPIキー取得

- [Google AI Studio](https://aistudio.google.com/apikey) にアクセス
- APIキーを発行して控えておきます

#### 2-3-2. Difyのモデルプロバイダー設定

- Dify管理画面を開く
> ![CleanShot 2025-08-09 at 12.39.07.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/ec511155-8374-433c-a275-3295daaf9111.png)
- Difyはモデルプロバイダーという画面から各種AIモデルを追加できます。
- モデルプロバイダー > Gemini > セットアップ
> ![CleanShot 2025-08-09 at 12.55.39.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/4f4ab1f6-9d74-421d-917e-60e5c9b2b349.png)
- 取得したAPIキーを貼り付けて保存
> ![CleanShot 2025-08-09 at 12.57.02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/672eb24d-f237-433a-adf5-198e9fd459bc.png)
- 接続が成功していることを確認
> ![CleanShot 2025-08-09 at 12.57.09.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/c16bba01-bce4-4cd1-a98b-5e5f5c65b170.png)

補足
- OpenAIのAPIキーがある人はOpenAIでもOKです（やりやすいもので大丈夫です）
- もしGeminiで制限が来た場合は、予備としてGroqを接続するのがおすすめです
  - [Groq コンソール](https://console.groq.com/home)

---

### 2-4. 動かしてみる（動作確認）

- チャットのプレビュー画面で質問してみる
  - 例: 日帰りで盛岡を楽しみたい。おすすめの回り方は？
  - 例: 盛岡冷麺を食べたい。アクセスしやすいエリアも教えて
- 返答が不自然なら、まずはプロンプトの指示を強めて再テストします
  - 例: まず日程と興味を質問してから提案して、など

---

## 3. Tips: デバッグのやり方と運用視点

### 3-1. プレビューでデバッグ

- まずはプレビューで短いやり取りを複数回試す
- うまくいかないときの見直し順
  1. プロンプトが具体的か（役割、制約、出力形式）
  2. 質問の仕方が曖昧すぎないか（条件不足なら追加質問を促しましょう）
  3. モデルが想定どおりに選べているか

### 3-2. 運用の入口（観測・改善の考え方）

- 試作でも、同じ質問を何回か投げて挙動のブレを確認する
- 想定Q&Aを5個くらい作って、毎回同じテストを回せる状態にすると改善が早い

---

## 4. チャレンジ課題

時間が余っている人はこちら。

- 課題1. 会話スターターを3つ追加して、初心者でも質問しやすいUIにする
- 課題2. 盛岡観光の前提質問テンプレを作る（予算、滞在時間、移動手段、興味）
- 課題3. Groqもモデルプロバイダーに追加して、切り替えて試す

---

## 5. まとめ

- Difyは、生成AIアプリをノーコードで作って運用まで持っていきやすい開発プラットフォームです（読み方は ディフィー）。
- このパートでは、まず動くチャットアプリを完成させ、Geminiを接続して試作を回しやすい状態にしました。
- 次のパートでRAG（資料参照）に進みます。

---

このページの内容は以上です。  

- [次の資料へ](./03_rag.md)
- [前の資料へ](./01_orientation.md)

[◀ 目次ページ](./readme.md)
