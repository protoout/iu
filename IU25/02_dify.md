# 02. Dify

このパートでは、Difyを使って「盛岡の観光アドバイザー」チャットアプリを最短で作り、さらに無料枠のあるGeminiをモデルとして接続します。  
試作で終わらず、動作確認まで到達するのがゴールです。

---

## 1. このパートで作るもの「盛岡の観光アドバイザーAIチャット」

### 1-1. 作成するものの概要

- Dify上で動く、盛岡観光の相談に答えるチャットアプリを作ります。
- まずはシンプルなチャットアプリとして完成させ、次のパート（RAG）で資料参照型に拡張していきます。

参考リンク
- [Dify チャットフロー入門（ベース記事）](https://zenn.dev/protoout/articles/81-start-dify-chatflow)
- [Google AI Studio（Gemini APIキー発行）](https://aistudio.google.com/apikey)

---

### 1-2. Difyとは？
Difyは、チャットボットや自動化の仕組みをノーコードやローコードで作ることができるAI開発プラットフォームです。
色々なAIモデルを活用・外部サービスとの連携で、自身や自分たちの業務に合わせたAI開発をすることができます。
2026年1月時点の無料枠では、200メッセージ利用でき、アプリは5個まで作ることができます。
参考：[Dify｜プランの比較](https://dify.ai/jp/pricing)

※ 2025年5月に、公式がDifyの読み方を「ディフィー」としました。
https://x.com/DifyJapan/status/1939577177848381690

### 1-3. Difyでできること
Difyは、ChatGPTなどの生成AIやLLMだけではカバーできない「社内知識の検索」や「各種SaaSとの連携・自動処理」を、非エンジニアでも手軽に実現できるツールです。 「自分で作れたらこうしたいのに……」という歯痒さを解消してくれます。
<img src="https://i.gyazo.com/ef7e476830cd9dda42e219ea1d657ae4.png" width="350px" alt="image from gyazo"/>

例えば、以下のようなこともできます。
- 自動化の仕組みを作ることで、複雑な業務もAIにお願いできる(1.情報を検索する→2.文章にまとめる→3.メールで送るなど)
- 作成したチャットアプリを、Webサイトに埋め込むことができる
- アカウント登録せずURLを共有するだけで、他の人に作ったものを使ってもらうことができる

### 1-4. アプリケーションの種類
アプリケーションには種類が5つあるため、作りたいものに合わせて選んでください。

<img src="https://i.gyazo.com/c66811abb20b26bcf084366d7fcb2e61.png" width="350px" alt="image from gyazo"/>

- チャットボット：ユーザーと会話形式でやり取りするシンプルなチャット
- エージェント：AIでタスクを実行するアプリ
- テキストジェネレーター：テキスト生成に特化したもの
- チャットフロー：チャットアプリとタスクの実行
- ワークフロー：プログラムっぽいタスクの実行

### 1-5. オンプレミス環境で構築できる
Difyは、自社が管理しているサーバー（パソコン）にインストールして利用ができるオンプレミス環境で構築することができます。ご自身のパソコンにインストールも可能です。

日本の大企業が社内で生成AIを利用する際に、外部のサーバーから切り離して利用したいケースは多いです。
完全にクラウドサービスよりも、オンプレミスでの利用も選択できるDifyは最善の選択とも言えると思います。

Difyと似たような立ち位置のクラウドサービスでは[miibo](https://miibo.ai/), [Coze](https://www.coze.com/)がありますが、Difyはクラウドサービス版とオンプレミス版と選べるのが利点です。

<img src="https://i.gyazo.com/81d87f5f47b809d6e1ffb59e3cbbd6e5.png" width="350px" alt="image from gyazo"/>

### 1-6. OSSでの開発
DifyはOSS（オープンソースソフトウェア）として、ソースコードが公開されています。
OSSとは、誰でも見られる場所にソースコードが無償で公開されていて、使用・改変・再配布などが自由にできるソフトウェアのことです。
複数の開発者が参画していることで開発速度も上がり、利用方法や活用事例の共有などコミュニティと共に盛り上がっている印象です。

- 参考：[Difyのソースコード](https://github.com/langgenius/dify)
- 参考：[東京都公式の新型コロナ対策サイトはオープンソースで作られた！](https://business.nikkei.com/atcl/seminar/19/00058/031000042/)

### 1-7. Difyの作例など
https://zenn.dev/protoout/books/15_dify-manual/viewer/example

---

## 2. Difyで盛岡の観光アドバイザーAIチャットを作るハンズオン

### 2-1. 準備: Difyアカウントと事前注意

まずは[こちら](https://zenn.dev/protoout/articles/81-start-dify-chatflow)の記事を元に、Difyでチャットアプリを作成します。  
記事内のプロンプトは秋葉原ではなく、盛岡の観光アドバイザーとして作ってみましょう。

---

### 2-2. モデルプロバイダーをGeminiへ接続（APIキー設定）

Difyはモデルプロバイダー画面から、使用するLLMを追加できます。  
無料枠があるGeminiを使うと、最初の試作が進めやすいです。

#### 2-2-1. GeminiのAPIキー取得

- [Google AI Studio](https://aistudio.google.com/apikey) にアクセス
- APIキーを発行して控えておきます

#### 2-2-2. Difyのモデルプロバイダー設定

- Dify管理画面を開く
> ![CleanShot 2025-08-09 at 12.39.07.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/ec511155-8374-433c-a275-3295daaf9111.png)
- Difyはモデルプロバイダーという画面から各種AIモデルを追加できます。
- モデルプロバイダー > Gemini > セットアップ
> ![CleanShot 2025-08-09 at 12.55.39.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/4f4ab1f6-9d74-421d-917e-60e5c9b2b349.png)
- 取得したAPIキーを貼り付けて保存
> ![CleanShot 2025-08-09 at 12.57.02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/672eb24d-f237-433a-adf5-198e9fd459bc.png)
- 接続が成功していることを確認
> ![CleanShot 2025-08-09 at 12.57.09.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/c16bba01-bce4-4cd1-a98b-5e5f5c65b170.png)

補足
- OpenAIのAPIキーがある人はOpenAIでもOKです（やりやすいもので大丈夫です）
- もしGeminiで制限が来た場合は、予備としてGroqを接続するのがおすすめです
  - [Groq コンソール](https://console.groq.com/home)

---

### 2-3. チャットアプリ作成（プロンプトを盛岡版にする）

ベース記事の手順に沿って、まずはチャットが動くところまで作ります。

- 設定のポイント
  - システムプロンプトを 盛岡の観光アドバイザー に変更する
  - 相談例（会話スターター）があると動作確認が速くなります

プロンプト例（コピペ用）
```
## 役割
- あなたは盛岡の観光アドバイザーです。
- ユーザーからの質問に対して盛岡観光に役立つ情報を提供してください。

## 制約事項
- ユーザーが不快に思う返信は禁止です。
```
---

### 2-4. 動かしてみる（動作確認）

- チャットのプレビュー画面で質問してみる
  - 例: 日帰りで盛岡を楽しみたい。おすすめの回り方は？
  - 例: 盛岡冷麺を食べたい。アクセスしやすいエリアも教えて
- 返答が不自然なら、まずはプロンプトの指示を強めて再テストします
  - 例: まず日程と興味を質問してから提案して、など

---

## 3. Tips: デバッグのやり方と運用視点

### 3-1. プレビューでデバッグ

- まずはプレビューで短いやり取りを複数回試す
- うまくいかないときの見直し順
  1. プロンプトが具体的か（役割、制約、出力形式）
  2. 質問の仕方が曖昧すぎないか（条件不足なら追加質問を促しましょう）
  3. モデルが想定どおりに選べているか

### 3-2. 運用の入口（観測・改善の考え方）

- 試作でも、同じ質問を何回か投げて挙動のブレを確認する
- 想定Q&Aを5個くらい作って、毎回同じテストを回せる状態にすると改善が早い

---

## 4. チャレンジ課題

時間が余っている人はこちら。

- 課題1. 会話スターターを3つ追加して、初心者でも質問しやすいUIにする
- 課題2. 盛岡観光の前提質問テンプレを作る（予算、滞在時間、移動手段、興味）
- 課題3. Groqもモデルプロバイダーに追加して、切り替えて試す

---

## 5. まとめ

- このパートでは、まず動くチャットアプリを完成させ、Geminiを接続して試作を回しやすい状態にしました。
- 次のパートでRAG（資料参照）に進みます。

---

このページの内容は以上です。  

- [次の資料へ](./03_rag.md)
- [前の資料へ](./01_orientation.md)

[◀ 目次ページ](./readme.md)
