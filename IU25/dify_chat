# 02-1. Difyで「盛岡の観光アドバイザーAIチャット」を作る

このパートでは、Difyでチャットアプリを作成し、授業で使うLLMとしてGeminiを接続します。  
最短で「作る → つなぐ → プロンプト調整 → 動作確認」まで到達するのがゴールです。

---

## 1. このパートで作るもの「盛岡の観光アドバイザーAIチャット」

### 1-1. 作成するものの概要

- Dify上で動く「盛岡観光の相談に答えるチャットアプリ」を作ります。
- 次のパート（RAG）で「資料参照型」に拡張します。

参考リンク
- [Dify チャットフロー入門（ベース記事）](https://zenn.dev/protoout/articles/81-start-dify-chatflow)

---

## 2. Difyでチャットアプリを作るハンズオン

### 2-1. STEP1：Difyでチャットアプリを作成

まずはベース記事に沿って、**チャットが動くところまで**作ります。  
記事内のプロンプトは秋葉原ではなく **盛岡の観光アドバイザー** に置き換えて進めてください。

- 参照する記事  
  https://zenn.dev/protoout/articles/81-start-dify-chatflow

- STEP1で「ここまでやればOK」（授業の到達ライン）
  - Difyでアプリを新規作成できている
  - チャットのプレビュー（試し会話）で1往復以上できている
  - （次のLINE連携のために）必要に応じて公開設定まで進める

> 注意: `ブラウザの自動翻訳機能をオフ`  
> 自動翻訳がオンだと表示が崩れたり、手順と画面名が噛み合わないことがあります。

---

### 2-2. STEP2：モデルプロバイダーをGeminiへ接続（APIキー設定）

授業ではGeminiを利用します（無料枠があり、試作が進めやすい前提）。  
Difyは「モデルプロバイダー」画面から、使用するLLMを追加できます。

#### 2-2-1. GeminiのAPIキーについて（共有方法により分岐）

**A. 講師（荻原先生）が発行したAPIキーを使う場合**
- 共有方法: ここに書く（例：当日Notionに掲載 / 口頭配布 / Slackで配布 など）
- 注意: APIキーは外部に公開しないでください（GitHubへ貼らない）

**B. 各自でAPIキーを発行する場合**
- [Google AI Studio](https://aistudio.google.com/apikey) からAPIキーを発行し、控えておきます。

---

#### 2-2-2. Difyのモデルプロバイダー設定（Gemini）

- Dify管理画面を開く
> ![CleanShot 2025-08-09 at 12.39.07.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/ec511155-8374-433c-a275-3295daaf9111.png)

- 「モデルプロバイダー」からGeminiを選び、`セットアップ`へ
> ![CleanShot 2025-08-09 at 12.55.39.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/4f4ab1f6-9d74-421d-917e-60e5c9b2b349.png)

- APIキーを貼り付けて保存
> ![CleanShot 2025-08-09 at 12.57.02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/672eb24d-f237-433a-adf5-198e9fd459bc.png)

- 接続が成功していることを確認
> ![CleanShot 2025-08-09 at 12.57.09.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35387/c16bba01-bce4-4cd1-a98b-5e5f5c65b170.png)

補足
- OpenAIのAPIキーがある人はOpenAIでもOKです
- もしGeminiで制限が来た場合は、予備としてGroqを接続するのがおすすめです  
  - [Groq コンソール](https://console.groq.com/home)

---

### 2-3. STEP3：プロンプトの変更（盛岡版にする）

ベース記事の手順に沿って、システムプロンプトを「盛岡の観光アドバイザー」に変更します。

- 設定のポイント
  - 役割（どんなAIか）
  - してほしいこと（どう答えるか）
  - 制約（やってはいけないこと）

プロンプト（ここから ぷとんぷと ※あなた側で差し替えOK）
- ここからぷとんぷと
- ここからぷとんぷと
- ここからぷとんぷと

---

### 2-4. STEP4：動かしてみよう（動作確認）

プレビュー画面で、以下のような質問を投げて動作確認します。

- テスト例
  - 日帰りで盛岡を楽しみたい。おすすめの回り方は？
  - 盛岡冷麺を食べたい。アクセスしやすいエリアも教えて
  - 予算3,000円、駅近、夕方から行ける観光スポットある？

うまくいかないときの調整
- 返答がふわっとする → プロンプトに「最初に条件を質問してから提案する」など明記
- 店名やイベントなどが怪しい → 次のRAGパートで「資料参照」に拡張して精度を上げる

---

## 3. Tips：デバッグのやり方（最小限）

### 3-1. プレビューでデバッグ

- まずは短いやり取りを複数回試す
- うまくいかないときの見直し順
  1. プロンプト（役割 / 制約 / 出力の形）が具体的か
  2. 質問が曖昧すぎないか（条件が足りないなら追加質問させる）
  3. モデルが想定どおりに選べているか

---

## 4. チャレンジ課題（余裕がある人向け）

- `課題1.` 会話スターターを3つ追加して、質問しやすい導線を作る
- `課題2.` 観光の前提質問テンプレを作る（予算 / 滞在時間 / 移動手段 / 興味）
- `課題3.` Groqもモデルプロバイダーに追加して、切り替えて試す

---

## 5. まとめ

- Difyでチャットアプリを作成し、Geminiを接続して動作確認まで完了しました。
- 次のパートでRAG（資料参照）を追加して、回答の根拠を安定させます。

---

このページの内容は以上です。  
[◀ 目次ページ](./readme.md)に戻り、全体構成を確認してから講師の指示にしたがって進めましょう。
